// iNeedATruck - Truck owner onboarding MVP
// Connect local truck owners with customers

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// User accounts (in-house; auth can be added later)
model User {
  id            String   @id @default(cuid())
  email         String   @unique
  emailVerified Boolean  @default(false)
  name          String
  phone         String?
  phoneVerified Boolean  @default(false)
  role          String   @default("customer") // "customer" | "truck_owner"
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  truckOwner TruckOwner?
  customer   Customer?
  jobsAsCustomer Job[] @relation("CustomerJobs")
}

// Truck owner profile — Identity & Trust
model TruckOwner {
  id                    String    @id @default(cuid())
  userId                String    @unique
  fullName              String
  profilePhotoUrl       String?
  phoneNumber           String
  serviceRadiusMiles    Int?      // OR use zipCodes
  zipCodes              String[]  @default([]) // alternative to radius
  bio                   String?
  driverLicenseFrontUrl String?
  driverLicenseBackUrl  String?
  insuranceFrontUrl     String?
  insuranceBackUrl      String?
  driverLicenseVerified Boolean   @default(false)
  insuranceConfirmed    Boolean   @default(false)
  backgroundCheckConsent Boolean  @default(false)
  platformFeePct        Decimal   @default(15) @db.Decimal(5, 2)
  membershipTier        String    @default("standard")
  isVerified            Boolean   @default(false)
  // Reputation (system-generated)
  ratingAvg             Decimal?  @db.Decimal(3, 2)
  totalJobsCompleted    Int       @default(0)
  responseTimeAvgMins   Int?
  onTimePercentage      Decimal?  @db.Decimal(5, 2)
  cancellationRate     Decimal?  @db.Decimal(5, 2)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  vehicles        Vehicle[]
  serviceOfferings ServiceOffering[]
  pricingProfile  PricingProfile?
  availability    Availability?
  jobs            Job[]
}

// Vehicle — multiple per owner
model Vehicle {
  id               String   @id @default(cuid())
  ownerId          String
  vehicleType      String   // pickup, pickup_trailer, flatbed, box_truck, dump_truck
  bedLengthFt      Decimal  @db.Decimal(4, 1)
  payloadCapacityLbs Int
  towingCapable    Boolean  @default(false)
  towCapacityLbs   Int?     // when towing capable
  awdOr4wd         Boolean  @default(false)
  // Optional
  vehiclePhotoUrls String[] @default([])
  hitchType        String?
  trailerSizeFt    Decimal? @db.Decimal(4, 1)   // when pickup_trailer
  trailerCapacityLbs Int?   // when pickup_trailer
  hasRamps         Boolean  @default(false)
  hasDolly         Boolean  @default(false)
  hasStraps        Boolean  @default(false)
  hasMovingBlankets Boolean @default(false)
  hasPlow          Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  owner TruckOwner @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId])
}

// Service offerings — seasonal toggle
model ServiceOffering {
  id           String   @id @default(cuid())
  ownerId      String
  serviceType  String   // pickup_delivery, junk_removal, small_moves, etc.
  seasonalTag  String   @default("all") // winter | spring | summer | fall | all
  createdAt    DateTime @default(now())

  owner TruckOwner @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@unique([ownerId, serviceType])
  @@index([ownerId])
}

// Pricing preferences
model PricingProfile {
  id                      String   @id @default(cuid())
  ownerId                 String   @unique
  hourlyRate              Decimal  @db.Decimal(10, 2)
  minimumJobPrice         Decimal  @db.Decimal(10, 2)
  perMileRate             Decimal? @db.Decimal(6, 2)
  emergencySurchargeEnabled Boolean @default(false)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  owner TruckOwner @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

// Availability
model Availability {
  id                    String    @id @default(cuid())
  ownerId               String    @unique
  availabilityType     String    // always, weekends, after_5pm, custom
  dailyHours            Json?     // { monday: { start: "09:00", end: "17:00" } | null, ... }
  seasonalAvailability String[]  @default([]) // winter, spring, summer, fall
  acceptsSameDayJobs    Boolean   @default(true)
  createdAt             DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  owner TruckOwner @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

// Customer profile
model Customer {
  id        String   @id @default(cuid())
  userId    String   @unique
  address   String?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Job booking — connects customer with truck owner
model Job {
  id             String    @id @default(cuid())
  customerId     String
  truckOwnerId   String
  serviceType    String?
  status         String    @default("pending")
  pickupAddress  String
  dropoffAddress String?
  description    String?
  photoUrls      String[]  @default([]) // up to 5 photos of items to haul
  totalAmount    Decimal   @db.Decimal(10, 2)
  platformFee    Decimal   @db.Decimal(10, 2)
  scheduledAt    DateTime?
  completedAt    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  customer   User       @relation("CustomerJobs", fields: [customerId], references: [id], onDelete: Cascade)
  truckOwner TruckOwner @relation(fields: [truckOwnerId], references: [id], onDelete: Cascade)

  @@index([customerId, status])
  @@index([truckOwnerId, status])
  @@index([status, createdAt])
}

// Seasonal platform offers (marketing promos)
model SeasonalOffer {
  id          String   @id @default(cuid())
  slug        String   @unique
  name        String
  description String?
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(true)
  promoCode   String?
  discountPct Decimal? @db.Decimal(5, 2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
